local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local Workspace = game:GetService("Workspace")

if game.GameId ~= 210851291 then
	pcall(function()
		Players.LocalPlayer:Kick("este script sÃ³ funciona no Build a Boat.")
	end)
	return
end

local isMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MangaHubMinimizeButton"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

local Button = Instance.new("TextButton")
Button.Size = isMobile and UDim2.fromOffset(30, 30) or UDim2.fromOffset(50, 50)
Button.Position = UDim2.new(0, 50, 0, 50)
Button.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
Button.Text = "ðŸ¥­"
Button.TextScaled = true
Button.TextColor3 = Color3.fromRGB(255, 255, 255)
Button.BorderSizePixel = 0
Button.AnchorPoint = Vector2.new(0.5, 0.5)
Button.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(1, 0)
UICorner.Parent = Button

local Fluent = loadstring(game:HttpGet(
	"https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"
))()

local Window = Fluent:CreateWindow({
	Title = "Manga Hub",
	SubTitle = "ProteÃ§Ãµes",
	TabWidth = isMobile and 120 or 160,
	Size = isMobile and UDim2.fromOffset(400, 350) or UDim2.fromOffset(580, 460),
	Acrylic = true,
	Theme = "Dark",
	MinimizeKey = Enum.KeyCode.LeftControl
})

getgenv().MangaHubWindow = Window

local Tabs = {
	Mar = Window:AddTab({ Title = "Mar", Icon = "ðŸŒŠ" })
}

local Options = Fluent.Options

local WaterCache = {}
local AntiWaterEnabled = false
local DescendantConnection

local function neutralizeWater(part)
	if not part:IsA("BasePart") then return end
	if part.Name ~= "Water" then return end

	-- salva estado original
	if not WaterCache[part] then
		WaterCache[part] = {
			CanTouch = part.CanTouch,
			CanCollide = part.CanCollide,
			Transparency = part.Transparency
		}
	end

	part.CanTouch = false
	part.CanCollide = false
	part.Transparency = 1

	for _, child in ipairs(part:GetChildren()) do
		if child:IsA("TouchInterest") then
			child:Destroy()
		end
	end
end

local function restoreWater()
	for part, state in pairs(WaterCache) do
		if part and part.Parent then
			part.CanTouch = state.CanTouch
			part.CanCollide = state.CanCollide
			part.Transparency = state.Transparency
		end
	end
	table.clear(WaterCache)
end

local function applyToAllWater()
	for _, obj in ipairs(Workspace:GetDescendants()) do
		if obj:IsA("BasePart") and obj.Name == "Water" then
			neutralizeWater(obj)
		end
	end
end

local function onNewDescendant(obj)
	if not AntiWaterEnabled then return end
	if obj:IsA("BasePart") and obj.Name == "Water" then
		task.wait()
		neutralizeWater(obj)
	end
end

Tabs.Mar:AddToggle("NoWaterDamage", {
	Title = "Desativar Water (sem dano)",
	Default = false
})

Options.NoWaterDamage:OnChanged(function(Value)
	AntiWaterEnabled = Value

	if Value then
		applyToAllWater()
		DescendantConnection = Workspace.DescendantAdded:Connect(onNewDescendant)
	else
		restoreWater()
		if DescendantConnection then
			DescendantConnection:Disconnect()
			DescendantConnection = nil
		end
	end
end)

Window:SelectTab(1)

Fluent:Notify({
	Title = "Manga Hub",
	Content = "Water neutralizado com sucesso!",
	Duration = 5
})
